

<%# column_chart [ {name:"Last 30 days", data:[[ "Day", daily_mean[0]]]}, {name: "All", data: [[ "Day", daily_mean[1]]]} ], library: { title: "Daily mean power usage (Watt/day)" } %>

<%
daily_mean = [ Pulse.daily_mean(current_user, Date.today-30, Date.today), Pulse.daily_mean(current_user) ]
daily_data = Pulse.daily(current_user)
dd = daily_mean.map { |dm| daily_data.map { |r| [ r[0], dm ] } }

hourly_mean = [ Pulse.hourly_mean(current_user, Date.today-30, Date.today), Pulse.hourly_mean(current_user) ]
hourly_data = Pulse.hourly(current_user)
hd = hourly_mean.map { |hm| hourly_data.map { |r| [ r[0], hm ] } }

%>

<%= column_chart [ 
	{name: "Last 30 days", data: Pulse.daily(current_user, Date.today-30, Date.today)}, 
	{name: "All time", data: daily_data}, 
	{name: "Last 30 days mean value", data: dd[0]},
	{name: "All time mean value", data: dd[1]} ],
	library: { title: "Daily power usage (Watt/day)", series: { 2 => { type: "line"}, 3 => { type: "line"} } } %>


<%= column_chart [ 
	{name: "Last 30 days", data: Pulse.hourly(current_user, Date.today-30, Date.today)}, 
	{name: "All time", data: hourly_data}, 
	{name: "Last 30 days mean value", data: hd[0]},
	{name: "All time mean value", data: hd[1]} ],
	library: { title: "Hourly power usage (Watt/hour)", series: { 2 => { type: "line"}, 3 => { type: "line"} } } %>


<%= column_chart [ 
	{name: "Last 30 days", data: Pulse.monthly(current_user, Date.today-30, Date.today)}, 
	{name: "All time", data: Pulse.monthly(current_user)} ],
	library: { title: "Monthly power usage (Watt/day)", series: { 2 => { type: "line"}, 3 => { type: "line"} } } %>

<%# line_chart Pulse.raw(Date.today-27, Date.today-20).map { |r| [r.pulse_time, r.power] }, library: { title: "Power usage (W)" } %>
